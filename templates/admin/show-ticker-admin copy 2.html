{% extends "/admin/base-template-admin.html" %}

{% block title %}Investinbulls.net{% endblock %}

{% block content %}
<head>
    <style>
        /* General body styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            width: 100vw;
            height: auto; /* Changed to auto for height adjustment */
        }
        /* Header styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #333;
            padding: 15px 30px;
            color: #fff;
        }

        .header h1 {
            font-size: 24px;
            margin: 0;
        }

        /* User profile on the top right */
        .user-profile {
            display: flex;
            align-items: center;
        }

        .user-profile img {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .user-profile .username {
            margin-right: 15px;
            font-size: 16px;
        }

        .user-profile .logout-btn {
            background-color: #ff4d4d;
            color: #fff;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        /* Ticker-Notes cell style */
        .ticker-notes {
            max-height: 2.6em; /* Approximately two lines of text */
            overflow-y: auto;  /* Enable vertical scrolling */
            white-space: normal; /* Allow text to wrap */
            word-wrap: break-word; /* Break long words if necessary */
            display: block; /* Ensures the div behaves like a block element */
        }

        /* Custom scrollbar styling (optional) */
        .ticker-notes::-webkit-scrollbar {
            width: 5px; /* Width of the scrollbar */
        }

        .ticker-notes::-webkit-scrollbar-thumb {
            background-color: #888; /* Color of the scrollbar */
            border-radius: 4px;
        }

        .ticker-notes::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }
        /* Container and Table styles */
        .container {
            width: 90%;
            margin: 30px auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
        }
        /* Set column width percentages */
        .col-1 { width: 13%; }
        .col-2 { width: 8%; }
        .col-3 { width: 6%; }
        .col-4 { width: 6%; }
        .col-5 { width: 6%; }
        .col-6 { width: 7%; }
        .col-7 { width: 7%; }
        .col-8 { width: 7%; }
        .col-9 { width: 7%; }
        .col-10 { width: 6%; }
        .col-11 { width: 5%; }
        .col-12 { width: 5%; }
        .col-13 { width: 15%; }
        .col-14 { width: 4%; }
        th {
            background-color: orange; /* Change header background color */
            color: black; /* White text for header */
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .editable {
            background-color: #ffffe0; /* Light yellow to indicate edit mode */
        }

        /* Icons */
        .action-icons {
            cursor: pointer;
            margin-right: 10px;
        }
        /* Search bar styles */
        .search-bar {
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-bar input[type="text"], .search-bar select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            margin-right: 10px;
        }

        .search-bar button {
            background-color: orange;
            color: black;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-bar button:hover {
            background-color: #e67e22;
        }
        .center-btn {
            display: flex;
            justify-content: center; /* Centers the button horizontally */
        }

        .center-btn input[type="submit"] {
            width: 50%; /* Optional: Adjust the width of the button */
            max-width: 200px; /* Optional: Limit the maximum width of the button */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .form-title {
            text-align: left;
            margin-bottom: 20px;
            color: #333;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px; /* Reduced gap for compactness */
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-group input[type="text"],
        .form-group textarea {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-group textarea {
            resize: none; /* Prevents resizing of the textarea */
        }

        .form-group input[type="submit"] {
            grid-column: span 2;
            background-color: orange;
            color: black;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
        }
        /* Button style to open the form */
        .open-popup-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: orange;
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px;
        }

        /* The overlay for the pop-up (full-screen) */
        .popup-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        /* The form container as a pop-up */
        .form-container {
            background-color: #fff;
            width: 25%; /* 1/4 of the screen */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Title styles */
        .form-title {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        /* General form styling */
        .form-grid {
            display: grid;
            grid-gap: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input[type="text"],
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }

        /* Submit button styling */
        .center-btn {
            text-align: center;
        }

        .btn {
            background-color: orange;
            color: black;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            background-color: #e67e22;
        }
        .form-row {
            display: flex;
            justify-content: space-between; /* Aligns the columns */
            margin-bottom: 5px; /* Space between rows */
        }

        .form-group {
            flex: 1; /* Makes each form-group take up equal space */
            margin-right: 10px; /* Space between groups */
        }
        /* Close button style */
        .close-btn {
            float: right;
            font-size: 20px;
            cursor: pointer;
            color: #aaa;
        }

        .close-btn:hover {
            color: #000;
        }
        .form-group input[type="submit"]:hover {
            background-color: orange;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header,
            .container {
                width: 100%;
                padding: 10px;
            }

            .search-bar input[type="text"],
            .search-bar select {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>

    <script>
        // Function to calculate 90% of the input value
        function calculatePercentage_bkp() {
            let amount = parseFloat(document.getElementById("amount").value.replace('$', ''));
            let discountPercentage = parseFloat(document.getElementById("discount").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let discountValue = (amount * discountPercentage) / 100;
                let finalAmount = amount - discountValue;
                document.getElementById("result").value = '$' + finalAmount.toFixed(2);
            }
        }
        // Function to calculate 90% of the input value
        function calculatePercentage() {
            let amount = parseFloat(document.getElementById("amount").value.replace('$', ''));
            let discountPercentage = parseFloat(document.getElementById("discount").value.replace('%', ''));
            let stopPrice = parseFloat(document.getElementById("result").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let discountValue = (amount * discountPercentage) / 100;
                let finalAmount = amount - discountValue;
                document.getElementById("result").value = '$' + finalAmount.toFixed(2);
            }
            if (!isNaN(amount) && !isNaN(stopPrice)) {
                let discountValue = (amount - stopPrice);
                let discountPercent = (discountValue / amount) * 100;
                document.getElementById("discount").value = '$' + discountPercent.toFixed(2);
                discountPercentage = parseFloat(document.getElementById("discount").value.replace('$', ''));
            }

            calculatePercentageTarget1(amount,discountPercentage);
            calculatePercentageTarget2(amount,discountPercentage);
            calculatePercentageTarget3(amount,discountPercentage);
            calculatePercentageTarget4(amount,discountPercentage);
        }


        // Calculate Target 1 (6%)
        function calculatePercentageTarget1(amount,discountPercentage) {
            //let amount = parseFloat(document.getElementById("amount").value.replace('$', ''));
            //let target1Percentage = 6;
            //let target1Percentage = parseFloat(document.getElementById("discount").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let target1Value = (amount * discountPercentage) / 100;
                //let finalAmount = amount + target1Value;
                let finalAmount = amount + (target1Value * 3);
                document.getElementById("target1").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 2 (12%)
        function calculatePercentageTarget2(amount,discountPercentage) {
            //let amount = parseFloat(document.getElementById("amount").value.replace('$', ''));
            // let target2Percentage = 12;
            //let target2Percentage = parseFloat(document.getElementById("discount").value.replace('%', ''));
            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let target2Value = (amount * discountPercentage) / 100;
                //let finalAmount = amount + target2Value;
                let finalAmount = amount + (target2Value * 5);
                document.getElementById("target2").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 3 (6%)
        function calculatePercentageTarget3(amount,discountPercentage) {
            //let amount = parseFloat(document.getElementById("amount").value.replace('$', ''));
            //let target1Percentage = 6;
            //let target1Percentage = parseFloat(document.getElementById("discount").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let target1Value = (amount * discountPercentage) / 100;
                //let finalAmount = amount + target1Value;
                let finalAmount = amount + (target1Value * 7);
                document.getElementById("target3").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 4 (6%)
        function calculatePercentageTarget4(amount,discountPercentage) {
            //let amount = parseFloat(document.getElementById("amount").value.replace('$', ''));
            //let target1Percentage = 6;
            //let target1Percentage = parseFloat(document.getElementById("discount").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let target1Value = (amount * discountPercentage) / 100;
                //let finalAmount = amount + target1Value;
                let finalAmount = amount + (target1Value * 10);
                document.getElementById("target4").value = '$' + finalAmount.toFixed(2);
            }
        }

        // For Edit |||||||||||||||||||||||
        // Function to calculate 90% of the input value
        function calculatePercentageEdit() {
            let amount = parseFloat(document.getElementById("edit-entry-price").value.replace('$', ''));
            let discountPercentage = parseFloat(document.getElementById("edit-stop-percent").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(discountPercentage)) {
                let discountValue = (amount * discountPercentage) / 100;
                let finalAmount = amount - discountValue;
                document.getElementById("edit-stop-price").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 1 (6%)
        function calculatePercentageTarget1Edit() {
            let amount = parseFloat(document.getElementById("edit-entry-price").value.replace('$', ''));
            //let target1Percentage = 6;
            let target1Percentage = parseFloat(document.getElementById("edit-stop-percent").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(target1Percentage)) {
                let target1Value = (amount * target1Percentage) / 100;
                //let finalAmount = amount + target1Value;
                let finalAmount = amount + (target1Value * 3);
                document.getElementById("edit-target-1").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 2 (12%)
        function calculatePercentageTarget2Edit() {
            let amount = parseFloat(document.getElementById("edit-entry-price").value.replace('$', ''));
            // let target2Percentage = 12;
            let target2Percentage = parseFloat(document.getElementById("edit-stop-percent").value.replace('%', ''));
            if (!isNaN(amount) && !isNaN(target2Percentage)) {
                let target2Value = (amount * target2Percentage) / 100;
                //let finalAmount = amount + target2Value;
                let finalAmount = amount + (target2Value * 5);
                document.getElementById("edit-target-2").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 1 (6%)
        function calculatePercentageTarget3Edit() {
            let amount = parseFloat(document.getElementById("edit-entry-price").value.replace('$', ''));
            //let target1Percentage = 6;
            let target1Percentage = parseFloat(document.getElementById("edit-stop-percent").value.replace('%', ''));

            if (!isNaN(amount) && !isNaN(target1Percentage)) {
                let target1Value = (amount * target1Percentage) / 100;
                //let finalAmount = amount + target1Value;
                let finalAmount = amount + (target1Value * 7);
                document.getElementById("edit-target-3").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Calculate Target 2 (12%)
        function calculatePercentageTarget4Edit() {
            let amount = parseFloat(document.getElementById("edit-entry-price").value.replace('$', ''));
            // let target2Percentage = 12;
            let target2Percentage = parseFloat(document.getElementById("edit-stop-percent").value.replace('%', ''));
            if (!isNaN(amount) && !isNaN(target2Percentage)) {
                let target2Value = (amount * target2Percentage) / 100;
                //let finalAmount = amount + target2Value;
                let finalAmount = amount + (target2Value * 10);
                document.getElementById("edit-target-4").value = '$' + finalAmount.toFixed(2);
            }
        }

        // Function to filter table rows based on search input and dropdown filters
        function filterTable() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toUpperCase();
            const tables = document.querySelectorAll('.ticker-table');

            tables.forEach(table => {
                const tr = table.getElementsByTagName('tr');
                let matchFound = false;

                for (let i = 1; i < tr.length; i++) {
                    let tdArray = tr[i].getElementsByTagName('td');
                    let rowMatchFound = false;

                    for (let j = 0; j < tdArray.length; j++) {
                        let td = tdArray[j];
                        if (td) {
                            // Check for search input match
                            if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
                                rowMatchFound = true;
                                matchFound = true;
                            }
                        }
                    }
                }
                // If no match found, hide the table
                table.style.display = matchFound ? "" : "none";
            });
        }

        // Function to toggle the visibility of the table
        function toggleTable(tableId) {
            const table = document.getElementById(tableId);
            const button = document.getElementById(`toggle-${tableId}`);
            if (table.style.display === "none" || table.style.display === "") {
                table.style.display = "table"; // Show the table
                button.innerHTML = "-"; // Change button text to minus
            } else {
                table.style.display = "none"; // Hide the table
                button.innerHTML = "+"; // Change button text to plus
            }
        }
        
        // Make the row editable and send selected row info to the backend
        function editRow(rowId) {
            let row = document.getElementById(rowId); // Select the row by its unique ID
            if (!row) {
                console.error("Row not found:", rowId);
                return;
            }

            // Send rowId to the backend to print it in the terminal
            fetch('/debug_log', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: `Editing row: ${rowId}` })
            });

            let cells = row.getElementsByTagName("td");

            // Add editable attributes to each cell except the action cell
            for (let i = 1; i < cells.length - 1; i++) {
                let cell = cells[i];
                let content = cell.innerText;
                cell.innerHTML = `<input type="text" value="${content}" />`;
                cell.classList.add("editable");
            }
        }

        // Update the row and send updated row info to the backend
        function updateRow(rowId) {
            let row = document.getElementById(rowId); // Select the row by its unique ID
            if (!row) {
                console.error("Row not found:", rowId);
                return;
            }

            // Send rowId to the backend to print it in the terminal
            fetch('/debug_log', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: `Updating row: ${rowId}` })
            });

            let cells = row.getElementsByTagName("td");
            let updatedData = {};

            // Extract updated values from input fields
            updatedData['created_date'] = cells[0].querySelector('input').value;
            updatedData['ticker_name'] = cells[1].querySelector('input').value;
            updatedData['entry_price'] = cells[2].querySelector('input').value;
            updatedData['stop_percent'] = cells[3].querySelector('input').value;
            updatedData['stop_price'] = cells[4].querySelector('input').value;
            updatedData['target_1'] = cells[5].querySelector('input').value;
            updatedData['target_2'] = cells[6].querySelector('input').value;
            updatedData['target_3'] = cells[7].querySelector('input').value;
            updatedData['target_4'] = cells[8].querySelector('input').value;
            updatedData['trail_stop'] = cells[9].querySelector('input').value;
            updatedData['ticker_status'] = cells[10].querySelector('input').value;
            updatedData['ticker_notes'] = cells[11].querySelector('input').value;

            // Call the backend to update the data
            fetch('/update_ticker', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Update successful");
                    // Replace the input fields with updated text and remove editable class
                    for (let i = 1; i < cells.length - 1; i++) {
                        let cell = cells[i];
                        let input = cell.querySelector('input');
                        cell.innerText = input.value;
                        cell.classList.remove("editable");
                    }
                } else {
                    alert("Update failed");
                }
            })
            .catch(error => {
                console.error("Error updating the row:", error);
                alert("An error occurred while updating the row");
            });
        }



        // Toggle visibility of tables by date
        function toggleTable(tableId) {
            const table = document.getElementById(tableId);
            const button = document.getElementById(`toggle-${tableId}`);
            if (table.style.display === "none" || table.style.display === "") {
                table.style.display = "table"; // Show the table
                button.innerHTML = "-"; // Change button text to minus
            } else {
                table.style.display = "none"; // Hide the table
                button.innerHTML = "+"; // Change button text to plus
            }
        }

        // On page load, only expand the first table by default
        window.onload = function() {
            const tables = document.querySelectorAll('.ticker-table');
            tables.forEach((table, index) => {
                if (index !== 0) {
                    table.style.display = "none"; // Hide all tables except the first one
                }
            });
        };
        // Function to open the pop-up
        function openPopup() {
            document.getElementById("popup").style.display = "flex";
        }

        // Function to open the pop-up
        function openEditPopup(data) {
            //document.getElementById("popupedit").style.display = "flex";

            const popupedit = document.getElementById("popupedit");
            popupedit.style.display = "flex";

            // Fill in the popup fields with data
            document.getElementById("edit-created-date").value = data.created_date;
            document.getElementById("edit-ticker-name").value = data.ticker_name;
            document.getElementById("edit-entry-price").value = data.entry_price;
            document.getElementById("edit-stop-percent").value = data.stop_percent;
            document.getElementById("edit-stop-price").value = data.stop_price;
            document.getElementById("edit-target-1").value = data.target_1;
            document.getElementById("edit-target-2").value = data.target_2;
            document.getElementById("edit-target-3").value = data.target_3;
            document.getElementById("edit-target-4").value = data.target_4;
            document.getElementById("edit-trail-stop").value = data.trail_stop;
            document.getElementById("edit-tickertype").value = data.ticker_type;
            document.getElementById("edit-status").value = data.ticker_status;
            document.getElementById("edit-notes").value = data.ticker_notes;

            // Store the rowId for updating
            document.getElementById("update-row-id").value = data.row_id;
        }

        // Function to close the pop-up
        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }
        // Function to close the pop-up
        function closeEditPopup() {
            document.getElementById("popupedit").style.display = "none";
        }

        function handleCreateTicker() {
            const createBtn = document.getElementById('create-ticker-btn');
            
            // Disable the button after it's clicked
            createBtn.disabled = true;

            // Call the actual function to update the ticker
            createTicker();

            // Close the popup after update
            closePopup();
        }

        function handleUpdateTicker() {
            const updateBtn = document.getElementById('update-ticker-btn');
            
            // Disable the button after it's clicked
            updateBtn.disabled = true;

            // Call the actual function to update the ticker
            updateTicker();

            // Close the popup after update
            closeEditPopup();
        }

        function closeEditPopup() {
            document.getElementById("popupedit").style.display = "none";
        }

        // Function to update the row
        function createTicker() {
            const createData = {
                tickername: document.getElementById("tickername").value,
                entryprice: document.getElementById("entryprice").value,
                stoppercent: document.getElementById("stoppercent").value,
                stopprice: document.getElementById("stopprice").value,
                target1: document.getElementById("target1").value,
                target2: document.getElementById("target2").value,
                target3: document.getElementById("target3").value,
                target4: document.getElementById("target4").value,
                tickertype: document.getElementById("tickertype").value,
                notes: document.getElementById("notes").value,
            };

            // Call the backend to update the data
            fetch('/save_ticker_new', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(createData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Create successful");
                    closePopup(); // Close popup on successful update
                    location.reload(); // Reload page to show updated data
                } else {
                    alert("Create failed");
                }
            })
            .catch(error => {
                console.error("Error creating the row:", error);
                //alert("An error occurred while updating the row");
            });
        }

        // Function to update the row
        function updateTicker() {
            const updatedData = {
                row_id: document.getElementById("update-row-id").value,
                created_date: document.getElementById("edit-created-date").value,
                ticker_name: document.getElementById("edit-ticker-name").value,
                entry_price: document.getElementById("edit-entry-price").value,
                stop_percent: document.getElementById("edit-stop-percent").value,
                stop_price: document.getElementById("edit-stop-price").value,
                target_1: document.getElementById("edit-target-1").value,
                target_2: document.getElementById("edit-target-2").value,
                target_3: document.getElementById("edit-target-3").value,
                target_4: document.getElementById("edit-target-4").value,
                trail_stop: document.getElementById("edit-trail-stop").value,
                ticker_type: document.getElementById("edit-tickertype").value,
                ticker_status: document.getElementById("edit-status").value,
                ticker_notes: document.getElementById("edit-notes").value,
            };

            // Call the backend to update the data
            fetch('/update_ticker', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Update successful");
                    closePopup(); // Close popup on successful update
                    location.reload(); // Reload page to show updated data
                } else {
                    alert("Update failed");
                }
            })
            .catch(error => {
                console.error("Error updating the row:", error);
                //alert("An error occurred while updating the row");
            });
        }
    </script>
</head>
<body>
    <!-- Pop-up container -->
    <div class="popup-overlay" id="popup">
        <div class="form-container">
            <!-- Close button -->
            <span class="close-btn" onclick="closePopup()">&times;</span>
            
            <!-- CREATE TICKER-->
            <h3 class="form-title">Create a New Ticker Entry</h3>
                    
            <div class="form-row">
                <div class="form-group">
                    <label for="fname">Ticker Name</label>
                    <input type="text" id="fname" name="tickername" placeholder="Ticker-Name" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="tickertype">Type</label>
                    <select id="tickertype" name="tickertype">
                        <option value="Swing">Swing</option>
                        <option value="Investment">Investment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">Entry Price ($)</label>
                    <input type="text" id="amount" name="entryprice" placeholder="$USD" 
                            required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="discount">Stop %</label>
                    <input type="text" id="discount" name="stoppercent" placeholder="%" 
                            oninput="calculatePercentage();" required>
                </div>

                <div class="form-group">
                    <label for="result">Stop Price ($)</label>
                    <input type="text" id="result" name="stopprice" 
                            oninput="calculatePercentage();" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="target1">Target-1 ($)</label>
                    <input type="text" id="target1" name="target1" required>
                </div>

                <div class="form-group">
                    <label for="target2">Target-2 ($)</label>
                    <input type="text" id="target2" name="target2" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="target3">Target-3 ($)</label>
                    <input type="text" id="target3" name="target3" required>
                </div>

                <div class="form-group">
                    <label for="target4">Target-4 ($)</label>
                    <input type="text" id="target4" name="target4" required>
                </div>
            </div>
            <!-- New textarea for notes -->
            <div class="form-row">
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" placeholder="Enter notes for the ticker" rows="1"></textarea>
                </div>
            </div>
            <div class="form-group center-btn">
                <button type="button" onclick="handleCreateTicker()" id="create-ticker-btn" class="btn">Create</button>
            </div>
        </div>
    
    </div>

    <!-- Pop-up Edit container -->
    <!-- EDIT TICKER-->
    <div class="popup-overlay" id="popupedit">
        <div class="form-container">
            <span class="close-btn" onclick="closeEditPopup()">&times;</span>
            <h3 class="form-title">Edit Ticker Entry</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Created-Date</label>
                    <div id="edit-created-date" readonly></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Ticker Name</label>
                    <input type="text" id="edit-ticker-name" readonly >
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="edit-tickertype">Type</label>
                    <input type="text" id="edit-tickertype" readonly>
                </div>
                <div class="form-group">
                    <label>Entry Price ($)</label>
                    <input type="text" id="edit-entry-price" placeholder="$USD" 
                        oninput="calculatePercentageEdit(); calculatePercentageTarget1Edit(); calculatePercentageTarget2Edit(); calculatePercentageTarget3Edit(); calculatePercentageTarget4Edit()" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Stop %</label>
                    <input type="text" id="edit-stop-percent" placeholder="%" 
                        oninput="calculatePercentageEdit(); calculatePercentageTarget1Edit(); calculatePercentageTarget2Edit(); calculatePercentageTarget3Edit(); calculatePercentageTarget4Edit()" required>
                </div>
                <div class="form-group">
                    <label>Stop Price ($)</label>
                    <input type="text" id="edit-stop-price" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Target-1 ($)</label>
                    <input type="text" id="edit-target-1" required>
                </div>
                <div class="form-group">
                    <label>Target-2 ($)</label>
                    <input type="text" id="edit-target-2" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Target-3 ($)</label>
                    <input type="text" id="edit-target-3" value="0" required>
                </div>
                <div class="form-group">
                    <label>Target-4 ($)</label>
                    <input type="text" id="edit-target-4" value="0" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Trail Stop</label>
                    <input type="text" id="edit-trail-stop" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="edit-status">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Profit-Book">Profit-Book</option>
                        <option value="Loss-Book">Loss-Book</option>
                    </select>
                </div>
            </div>
            

            <div class="form-row">
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="edit-notes" rows="3" placeholder="Enter notes for the ticker"></textarea>
                </div>
            </div>

            <input type="hidden" id="update-row-id">
            <div class="form-group center-btn">
                <button type="button" onclick="handleUpdateTicker()" id="update-ticker-btn" class="btn">Update Ticker</button>
            </div>
        </div>
    </div>

    <div class="open-popup-btn">
        <!-- Button to open the pop-up -->
        <button onclick="openPopup()">Create Ticker</button>
        
        <!-- Search bar -->
        <input type="text" id="searchInput" placeholder="Search tickers...">
        <button onclick="filterTable()">Search</button>

        <a href="/showadmintickers" ><button>Refresh</button></a>
    </div>
    <!-- Display a single table for each date -->
    {% for date, entries in grouped_tickers.items() %}
    <h3>
        <button id="toggle-table-{{ date }}" onclick="toggleTable('table-{{ date }}')">-</button>
        {{ date }}
    </h3>
    <table id="table-{{ date }}" class="ticker-table">
        <thead>
            <tr>
                <th class="col-1">Date/Time</th>
                <th class="col-2">Stock Ticker</th>
                <th class="col-3">Entry Price</th>
                <th class="col-4">Stop %</th>
                <th class="col-5">Stop Price</th>
                <th class="col-6">Target 1</th>
                <th class="col-7">Target 2</th>
                <th class="col-8">Target 3</th>
                <th class="col-9">Target 4</th>
                <th class="col-10">Trailstop</th>
                <th class="col-11">Type</th>
                <th class="col-12">Stock Status</th>
                <th class="col-13">Ticker-Notes</th>
                <th class="col-14">Edit</th>
            </tr>
        </thead>
        <tbody>
            {% for ticker in entries %}
            <tr id="row-{{ loop.index }}">
                <td>{{ ticker.created_date }}</td>
                <td>{{ ticker.ticker_name }}</td>
                <td>{{ ticker.entry_price }}</td>
                <td>{{ ticker.stop_percent }}</td>
                <td>{{ ticker.stop_price }}</td>
                <td>{{ ticker.target_1 }}</td>
                <td>{{ ticker.target_2 }}</td>
                <td>{{ ticker.target_3 }}</td>
                <td>{{ ticker.target_4 }}</td>
                <td>{{ ticker.trail_stop }}</td>
                <td>{{ ticker.ticker_type }}</td>
                <td>{{ ticker.ticker_status}}</td>
                <td>
                    <div class="ticker-notes">{{ ticker.ticker_notes }}</div>
                </td>
                <!-- <td> -->
                    <!--<span class="action-icons" onclick="editRow('row-{{ loop.index }}')">✏️ </span> -->
                    <!--<span class="action-icons" onclick="updateRow('row-{{ loop.index }}')">✅</span> -->
                    <!--<span class="action-icons" onclick='openEditPopup({ "row_id": "{{ loop.index }}", "created_date": "{{ ticker.created_date }}", "ticker_name": "{{ ticker.ticker_name }}", "entry_price": "{{ ticker.entry_price }}", "stop_percent": "{{ ticker.stop_percent }}", "stop_price": "{{ ticker.stop_price }}", "target_1": "{{ ticker.target_1 }}", "target_2": "{{ ticker.target_2 }}", "target_3": "{{ ticker.target_3 }}", "target_4": "{{ ticker.target_4 }}", "trail_stop": "{{ ticker.trail_stop }}", "ticker_status": "{{ ticker.ticker_status }}", "ticker_notes": "{{ ticker.ticker_notes }}" });'>✏️ </span> -->
                <!--</td> -->
                <td class="action-icons">
                    <span onclick='openEditPopup({ "row_id": "{{ loop.index }}", "created_date": "{{ ticker.created_date }}", "ticker_name": "{{ ticker.ticker_name }}", "entry_price": "{{ ticker.entry_price }}", "stop_percent": "{{ ticker.stop_percent }}", "stop_price": "{{ ticker.stop_price }}", "target_1": "{{ ticker.target_1 }}", "target_2": "{{ ticker.target_2 }}", "target_3": "{{ ticker.target_3 }}", "target_4": "{{ ticker.target_4 }}", "trail_stop": "{{ ticker.trail_stop }}", "ticker_type": "{{ ticker.ticker_type }}", "ticker_status": "{{ ticker.ticker_status }}", "ticker_notes": "{{ ticker.ticker_notes }}" });'>✏️ </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}
</body>

{% endblock %}
